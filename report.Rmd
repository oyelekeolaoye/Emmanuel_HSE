---
title: "HSE Project"
subtitle: "Descriptive Statistics"
author: "Oyeleke Olaoye; oyelekeolaoye@gmail.com"
date: "2023-06-10"
output: 
  html_document:
    toc: yes
    toc_float: yes
    theme: paper
    number_sections: yes
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(readstata13)
library(tidyverse)
library(eq5d)
library(table1)

################################################
#--------------2003-----------------------------
################################################


#read raw data and assign NAs to values as defined by the authors
hse_2003_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse03ai.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8'))

#select variables of interest and filter for desired age range
hse_2003 <- hse_2003_raw %>%
  filter(age > 15 & age < 65) %>%
  mutate(year = "2003") %>%
  select(year, pserial, age, sex, weight, econact, topqual3, ghqg2, genhelf2, 
         ghqconc, ghqdecis, ghqsleep, ghqconfi, ghquse, ghqstrai, ghqover, ghqenjoy, ghqface, ghqunhap, ghqworth, ghqhappy, mobility, selfcare, usualact, pain, anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2003) == "ghqconc")
end_col <- which(names(hse_2003) == "ghqhappy")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2003)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2003 <- hse_2003 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2003$ghq36scr <- rowSums(hse_2003[, start_col:end_col])

#Dealing with GHQG2 
#Authors have recoded as follows VALUE LABELS ghqg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2003 <- hse_2003 %>%
  mutate(ghqg2 = fct_recode(as.factor(ghqg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2003$mobility, hse_2003$selfcare, hse_2003$usualact, hse_2003$pain, hse_2003$anxiety)

# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2003$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2003 <- hse_2003 %>%
  mutate(sex = fct_recode(as.factor(sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2003$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2003$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2003) == "ghqconc")
end_col <- which(names(hse_2003) == "anxiety")
cols_to_exclude <- names(hse_2003)[start_col:end_col]
hse_2003 <- hse_2003[, !(names(hse_2003) %in% cols_to_exclude)]


#retain complete cases//// 1.6k observations removed
hse_2003_complete <- na.omit(hse_2003) %>%
  rename(GHQg2 = ghqg2)




################################################
#--------------2004-----------------------------
################################################

#read raw data and assign NAs to values as defined by the authors
hse_2004_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse04etha.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8'))

#select variables of interest and filter for desired age range
hse_2004 <- hse_2004_raw %>%
  filter(age > 15 & age < 65) %>%
  mutate(year = "2004") %>%
  select(year, pserial, age, sex, weight, econact, topqual3, GHQg2, genhelf2, 
         ghqconc, ghqdecis, ghqsleep, ghqconfi, ghquse, ghqstrai, ghqover, ghqenjoy, ghqface, ghqunhap, ghqworth, ghqhappy, mobility, selfcare, usualact, pain, anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2004) == "ghqconc")
end_col <- which(names(hse_2004) == "ghqhappy")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2004)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2004 <- hse_2004 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2004$ghq36scr <- rowSums(hse_2004[, start_col:end_col])

#Dealing with GHQg2 
#Authors have recoded as follows VALUE LABELS GHQg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2004 <- hse_2004 %>%
  mutate(GHQg2 = fct_recode(as.factor(GHQg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2004$mobility, hse_2004$selfcare, hse_2004$usualact, hse_2004$pain, hse_2004$anxiety)
# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2004$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2004 <- hse_2004 %>%
  mutate(sex = fct_recode(as.factor(sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2004$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2004$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2004) == "ghqconc")
end_col <- which(names(hse_2004) == "anxiety")
cols_to_exclude <- names(hse_2004)[start_col:end_col]
hse_2004 <- hse_2004[, !(names(hse_2004) %in% cols_to_exclude)]


#retain complete cases//// 1.9k observations removed
hse_2004_complete <- na.omit(hse_2004)




################################################
#--------------2005-----------------------------
################################################

#read raw data and assign NAs to values as defined by the authors
hse_2005_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse05ai.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8'))

#select variables of interest and filter for desired age range
hse_2005 <- hse_2005_raw %>%
  filter(age > 15 & age < 65) %>%
  mutate(year = "2005") %>%
  select(year, pserial, age, sex, weight, econact, topqual3, GHQg2, genhelf2, 
         ghqconc, ghqdecis, ghqsleep, ghqconfi, ghquse, ghqstrai, ghqover, ghqenjoy, ghqface, ghqunhap, ghqworth, ghqhappy, mobility, selfcare, usualact, pain, anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2005) == "ghqconc")
end_col <- which(names(hse_2005) == "ghqhappy")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2005)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2005 <- hse_2005 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2005$ghq36scr <- rowSums(hse_2005[, start_col:end_col])

#Dealing with GHQg2 
#Authors have recoded as follows VALUE LABELS GHQg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2005 <- hse_2005 %>%
  mutate(GHQg2 = fct_recode(as.factor(GHQg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2005$mobility, hse_2005$selfcare, hse_2005$usualact, hse_2005$pain, hse_2005$anxiety)
# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2005$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2005 <- hse_2005 %>%
  mutate(sex = fct_recode(as.factor(sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2005$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2005$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2005) == "ghqconc")
end_col <- which(names(hse_2005) == "anxiety")
cols_to_exclude <- names(hse_2005)[start_col:end_col]
hse_2005 <- hse_2005[, !(names(hse_2005) %in% cols_to_exclude)]


#retain complete cases//// 1.2k observations removed
hse_2005_complete <- na.omit(hse_2005)


################################################
#--------------2006-----------------------------
################################################

#read raw data and assign NAs to values as defined by the authors
hse_2006_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse06ai.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8'))

#select variables of interest and filter for desired age range
hse_2006 <- hse_2006_raw %>%
  filter(age > 15 & age < 65) %>%
  mutate(year = "2006") %>%
  select(year, pserial, age, sex, weight, econact, topqual3, GHQg2, genhelf2, 
         ghqconc, ghqdecis, ghqsleep, ghqconfi, ghquse, ghqstrai, ghqover, ghqenjoy, ghqface, ghqunhap, ghqworth, ghqhappy, mobility, selfcare, usualact, pain, anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2006) == "ghqconc")
end_col <- which(names(hse_2006) == "ghqhappy")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2006)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2006 <- hse_2006 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2006$ghq36scr <- rowSums(hse_2006[, start_col:end_col])

#Dealing with GHQg2 
#Authors have recoded as follows VALUE LABELS GHQg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2006 <- hse_2006 %>%
  mutate(GHQg2 = fct_recode(as.factor(GHQg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2006$mobility, hse_2006$selfcare, hse_2006$usualact, hse_2006$pain, hse_2006$anxiety)
# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2006$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2006 <- hse_2006 %>%
  mutate(sex = fct_recode(as.factor(sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2006$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2006$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2006) == "ghqconc")
end_col <- which(names(hse_2006) == "anxiety")
cols_to_exclude <- names(hse_2006)[start_col:end_col]
hse_2006 <- hse_2006[, !(names(hse_2006) %in% cols_to_exclude)]


#retain complete cases//// 1.8k observations removed
hse_2006_complete <- na.omit(hse_2006)


################################################
#--------------2008-----------------------------
################################################
#read raw data and assign NAs to values as defined by the authors
hse_2008_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse08ai.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8'))

#select variables of interest and filter for desired age range
hse_2008 <- hse_2008_raw %>%
  filter(age > 15 & age < 65) %>%
  mutate(year = "2008") %>%
  select(year, pserial, age, sex, weight, econact, topqual3, GHQg2, genhelf2, 
         ghqconc, ghqdecis, ghqsleep, ghqconfi, ghquse, ghqstrai, ghqover, ghqenjoy, ghqface, ghqunhap, ghqworth, ghqhappy, mobility, selfcare, usualact, pain, anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2008) == "ghqconc")
end_col <- which(names(hse_2008) == "ghqhappy")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2008)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2008 <- hse_2008 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2008$ghq36scr <- rowSums(hse_2008[, start_col:end_col])

#Dealing with GHQg2 
#Authors have recoded as follows VALUE LABELS GHQg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2008 <- hse_2008 %>%
  mutate(GHQg2 = fct_recode(as.factor(GHQg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2008$mobility, hse_2008$selfcare, hse_2008$usualact, hse_2008$pain, hse_2008$anxiety)
# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2008$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2008 <- hse_2008 %>%
  mutate(sex = fct_recode(as.factor(sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2008$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2008$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2008) == "ghqconc")
end_col <- which(names(hse_2008) == "anxiety")
cols_to_exclude <- names(hse_2008)[start_col:end_col]
hse_2008 <- hse_2008[, !(names(hse_2008) %in% cols_to_exclude)]


#retain complete cases//// 1.8k observations removed
hse_2008_complete <- na.omit(hse_2008)

################################################
#--------------2010-----------------------------
################################################
#read raw data and assign NAs to values as defined by the authors
hse_2010_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse10ai.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8', '-90'))

#select variables of interest and filter for desired age range
hse_2010 <- hse_2010_raw %>%
  filter(age > 15 & age < 65) %>%
  mutate(year = "2010") %>%
  select(year, pserial, age, sex, weight, econact, topqual3, ghqg2, genhelf2, 
         ghqconc, ghqdecis, ghqsleep, ghqconfi, ghquse, ghqstrai, ghqover, ghqenjoy, ghqface, ghqunhap, ghqworth, ghqhappy, mobility, selfcare, usualact, pain, anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2010) == "ghqconc")
end_col <- which(names(hse_2010) == "ghqhappy")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2010)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2010 <- hse_2010 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2010$ghq36scr <- rowSums(hse_2010[, start_col:end_col])

#Dealing with ghqg2 
#Authors have recoded as follows VALUE LABELS ghqg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2010 <- hse_2010 %>%
  mutate(ghqg2 = fct_recode(as.factor(ghqg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2010$mobility, hse_2010$selfcare, hse_2010$usualact, hse_2010$pain, hse_2010$anxiety)
# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2010$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2010 <- hse_2010 %>%
  mutate(sex = fct_recode(as.factor(sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2010$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2010$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2010) == "ghqconc")
end_col <- which(names(hse_2010) == "anxiety")
cols_to_exclude <- names(hse_2010)[start_col:end_col]
hse_2010 <- hse_2010[, !(names(hse_2010) %in% cols_to_exclude)]


#retain complete cases//// 1.4k observations removed
hse_2010_complete <- na.omit(hse_2010) %>%
  rename(GHQg2 = ghqg2)


################################################
#--------------2012-----------------------------
################################################
#read raw data and assign NAs to values as defined by the authors
hse_2012_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse2012ai.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8', '-90'))

#select variables of interest and filter for desired Age range
hse_2012 <- hse_2012_raw %>%
  filter(Age > 15 & Age < 65) %>%
  mutate(year = "2012") %>%
  select(year, pserial, Age, Sex, Weight, econact, topqual3, GHQg2, genhelf2, 
         GHQCONC, GHQDECIS, GHQSLEEP, GHQCONFI, GHQUSE, GHQSTRAI, GHQOVER, GHQENJOY, GHQFACE, GHQUNHAP, GHQWORTH, GHQHAPPY, Mobility, Selfcare, UsualAct, Pain, Anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2012) == "GHQCONC")
end_col <- which(names(hse_2012) == "GHQHAPPY")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2012)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2012 <- hse_2012 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2012$ghq36scr <- rowSums(hse_2012[, start_col:end_col])

#Dealing with GHQg2 
#Authors have recoded as follows VALUE LABELS GHQg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2012 <- hse_2012 %>%
  mutate(GHQg2 = fct_recode(as.factor(GHQg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2012$Mobility, hse_2012$Selfcare, hse_2012$UsualAct, hse_2012$Pain, hse_2012$Anxiety)
# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2012$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2012 <- hse_2012 %>%
  mutate(Sex = fct_recode(as.factor(Sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2012$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2012$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2012) == "GHQCONC")
end_col <- which(names(hse_2012) == "Anxiety")
cols_to_exclude <- names(hse_2012)[start_col:end_col]
hse_2012 <- hse_2012[, !(names(hse_2012) %in% cols_to_exclude)]


#retain complete cases//// 1.4k observations removed
hse_2012_complete <- na.omit(hse_2012) %>%
  rename(age = Age, sex = Sex, weight = Weight)


################################################
#--------------2014-----------------------------
################################################
#read raw data and assign NAs to values as defined by the authors
hse_2014_raw <- read.table("C:/Users/oyele/OneDrive/Documents/The Lake/Business/Private Work/HSE Project/hse2014ai.tab", header = T, sep = "\t", na.strings = c('-1', '-2', '-9', '-8', '-90'))

#select variables of interest and filter for desired Age90 range
hse_2014 <- hse_2014_raw %>%
  filter(Age90 > 15 & Age90 < 65) %>%
  mutate(year = "2014") %>%
  select(year, pserial, Age90, Sex, Weight, econact, topqual3, GHQg2, genhelf2, 
         GHQCONC, GHQDECIS, GHQSLEEP, GHQCONFI, GHQUSE, GHQSTRAI, GHQOVER, GHQENJOY, GHQFACE, GHQUNHAP, GHQWORTH, GHQHAPPY, Mobility, Selfcare, UsualAct, Pain, Anxiety)

# define the columns to recode to likert scoring 0-36
start_col <- which(names(hse_2014) == "GHQCONC")
end_col <- which(names(hse_2014) == "GHQHAPPY")

# Now use these indices with the `:` operator to select the columns
cols <- names(hse_2014)[start_col:end_col]

# recode scores fit make 0-36 likert single score across the 12 questions
hse_2014 <- hse_2014 %>%
  mutate(across(all_of(cols), ~case_when(. == 1 ~ 0,
                                         . == 2 ~ 1,
                                         . == 3 ~ 2,
                                         . == 4 ~ 3),
                .names = "{.col}"))
hse_2014$ghq36scr <- rowSums(hse_2014[, start_col:end_col])

#Dealing with GHQg2 
#Authors have recoded as follows VALUE LABELS GHQg2 ///1 'Score 0' /// 2 'Score 1-3' /// 3 'Score 4+'.
# Recode 1 and 2 as No case and 3 as Case
hse_2014 <- hse_2014 %>%
  mutate(GHQg2 = fct_recode(as.factor(GHQg2), `No case` = '1', `No case` = '2', `Case Mental Health` = '3'))


#Dealing with EQ5 - which is on 3 levels based on unique values of the 5 variables associated
#make a string for each individual score across all 5 dimensions
scores <- str_c(hse_2014$Mobility, hse_2014$Selfcare, hse_2014$UsualAct, hse_2014$Pain, hse_2014$Anxiety)
# Calculate the EQ-5D-3L score using the UK TTO value set
hse_2014$EQMEAN <- eq5d(scores=scores, country="UK", version="3L", type="TTO", ignore.invalid = TRUE)


# Recode variables
hse_2014 <- hse_2014 %>%
  mutate(Sex = fct_recode(as.factor(Sex), `Male` = '1', `Female` = '2'),
         econact = fct_recode(as.factor(econact), `In employment` = '1', `ILO unemployed` = '2', 
                              Retired = '3', `Other economically inactive` = '4'),
         genhelf2 = fct_recode(as.factor(hse_2014$genhelf2), `Very good/good` = '1',
                               Fair = '2',
                               `Bad/very bad` = '3'),
         topqual3 = fct_recode(as.factor(hse_2014$topqual3), `Missing value` = '6',
                               `Missing value` = '-1',
                               `Degree and equivalent` = '1',
                               `Below degree` = '2',
                               `Below degree` = '3',
                               `Below degree` = '4',
                               `Below degree` = '5',
                               `No degree` = '7'))

# Drop unusused variables
start_col <- which(names(hse_2014) == "GHQCONC")
end_col <- which(names(hse_2014) == "Anxiety")
cols_to_exclude <- names(hse_2014)[start_col:end_col]
hse_2014 <- hse_2014[, !(names(hse_2014) %in% cols_to_exclude)]


#retain complete cases//// 1.3k observations removed
hse_2014_complete <- na.omit(hse_2014) %>% rename(age = Age90, sex = Sex, weight = Weight)


all_years <- rbind(hse_2003_complete, hse_2004_complete, hse_2005_complete, hse_2006_complete, hse_2008_complete, hse_2010_complete, hse_2012_complete, hse_2014_complete)


```

# Table 1 (GHQG2 as outcome)

```{r, echo=FALSE, warning=FALSE}
table1::table1(~ factor(year) + factor(econact) + factor(sex) + age + weight + factor(topqual3) | GHQg2, data = all_years)
```

# Table 1 (GENHELF2 as outcome)

```{r, echo=FALSE, warning=FALSE}
table1::table1(~ factor(year) + factor(econact) + factor(sex) + age + weight + factor(topqual3) | genhelf2, data = all_years)
```

# Table 1 (EQ5-3L as outcome)

```{r, echo=FALSE, warning=FALSE}
table1::table1(~ factor(year) + factor(econact) + factor(sex) + age + weight + factor(topqual3) | EQMEAN, data = all_years)
```

# Table 1 (GHQ36SCR as outcome)

```{r, echo=FALSE, warning=FALSE}
table1::table1(~ factor(year) + factor(econact) + factor(sex) + age + weight + factor(topqual3) | ghq36scr, data = all_years)
```

# Notes

1.  For 2003 dataset, year variable was removed due to confidentiality (see variable guide page 8)
2.  The scoring of GHQ-12 can be done in a couple of ways:
    -   Bimodal scoring (0-0-1-1): Each item is scored 0-0-1-1, with the two least symptomatic answers scored 0 and the two most symptomatic answers scored 1, providing a range from 0 to 12. **This is what the authors of the dataset used.**
    -   Likert scoring (0-1-2-3): A score of 0-1-2-3 is allocated to each answer and the scores are summed, providing a range from 0 to 36. This is the one I used as **instructed**.
    -   The interpretation of the score depends on the context and the scoring method used, but a higher score typically indicates more severe psychological distress.
3.  Using the methodology outlined in the R package EQ5D documentation, I obtained the same result as the authors of the dataset.
4.  Table1 will only work with complete dataset causing any observation with NA value to be removed.
5.  No GHQG2 in 2007, 2011, 2013, 2015, 2017, 2019 - I have skipped these years. Some of these like 2013, 2015, 2017, 2019 do not have EQ-5d variables too.
6.  No EQ-5d for 2009, 2016, 2018, 2000, 2001, 2002 - I have skipped these years.
7.  For 2014 'age' was named 'age90'.
8.  **Self rated health (Genhelf2) looks like the only consistent Mental health measure through the years. I'll recommend this the outcome variable.**
